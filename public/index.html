<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ðŸ’©</title>

		<script src="https://www.gstatic.com/firebasejs/3.6.1/firebase.js"></script>
		<script>
			var config = {
				apiKey: "AIzaSyC_-EqCOnvt6AbeI-p46FZQaxrV1b2SyMA",
				authDomain: "saypoop-dev.firebaseapp.com",
				databaseURL: "https://saypoop-dev.firebaseio.com",
				storageBucket: "saypoop-dev.appspot.com",
				messagingSenderId: "888469153156"
			};
			firebase.initializeApp(config);
		</script>
	</head>
  <body>
    <header>
      <h1>saypoop ðŸ’©</h1>
    </header>
    <div id="formContainer">
			<input id="poopTextBox" placeholder="poop here">
			<button id="postPoopButton" onclick="postPoop()">Post</button>
    </div>
    <script>
			function postPoop() {
        var poopTextBox = document.getElementById("poopTextBox")
        var text = poopTextBox.value
        posted_at = new Date().getTime()
			  var poopData = {
          text,
          posted_at
        }
        console.log(poopData)
        var result = firebase.database().ref("/poops/").push(poopData)
        poopTextBox.value = ""
        console.log("pushed. result:")
        console.log(result)
			}
    </script>
    <div id="poopsContainer">
      <ul id="poops">
      </ul>
    </div>
    <script>
      window.onload = function() {
        // Authentication
        firebase.auth().signInAnonymously().catch(function(error) {
          console.error(error)
        })

        // Listeners
        firebase.database().ref("/poops").on("child_added", function(data) {
          var poopList = document.getElementById("poops")
          var poop = document.createElement("li")
          poop.innerText = data.val().text
          poopList.appendChild(poop)
        })
      }
    </script>
  </body>
</html>
